# 理解websocket

## osi七层模型简单理解
小明想把家乡特产(我们真正想要获得的数据信息)寄给远方的小王，他首先要做的事情是把特产用包装袋包裹成一个小的包裹，并且填写好要寄的地址，快递员来了之后，把包裹拿回物流中心，然后根据填写的地址分捡到对应的省份物流中心，然后物流快递公司会把这一整个省份的快递放到一个大的集装箱子里面，寄到这个省之后，再把集装箱拆开，根据不同的市进行分捡，最后快递给小王，小王拿到快递之后，拆开包裹，拿到小明寄的家乡特产。

![](http://7fvanf.com1.z0.glb.clouddn.com/17-10-7/38827849.jpg)

应用层：通过应用程序来完成网络用户的应用需求
表示层：处理流经结点的数据编码的表示方式问题
会话层：负责建立、管理和终止应用程序之间的通信会话
传输层：为上层协议提供端到端的可靠和透明的数据传输服务
网络层：通过路径选择算法(路由)将数据包送到目的地
数据链路层：通过校验、确认和反馈重发等手段，将不可靠的物理链路转换成对网络层来说无差错的数据链路
物理层：利用传输介质(网线、微波)为上层提供物理连接

我们的http协议是属于应用层，应用层主要是提供应用程序间的交换和数据交换，常见的有http协议、smtp协议、ftp协议...

应用层以下是传输层，有tcp和udp,我们接触得最多的是tcp协议，因为http协议底层就是tcp协议。

tcp协议：TCP协议位于传输层，提供可靠的字节流服务。所谓的字节流服务是指，为了方便传输，将大块数据分割成以报文段为单位的数据包进行管理。而可靠的传输服务是指，能够把数据准确可靠的传给对方。一言以蔽之，TCP协议为了更容易传送大数据才把数据分割，而且TCP协议能够准确确认数据最终是否送达对方

为了准确无误的将数据送达目标处，TCP协议采用了三次握手策略，用TCP协议把数据包送出去之后，TCP不会对传送后的情况置之不理，它一定会向对方确认是否成功送达。

![](http://7fvanf.com1.z0.glb.clouddn.com/17-10-7/12336541.jpg)


## 短连接和长连接

在http1.0的时代，浏览器和服务器每进行一次HTTP操作，就建立一次连接，但任务结束就中断连接。如果客户端浏览器访问的某个HTML或其他类型的 Web页中包含有其他的Web资源，如JavaScript文件、图像文件、CSS文件等；当浏览器每遇到这样一个Web资源，就会建立一个HTTP会话。这是短连接，因为当时的网速和带宽的限制，所以，这样设计是合理的，但是带来的问题就是用户体验不是特别的好。
随着带宽和网速的增强，同时为了更好的用户体验，现在慢慢的大部分网站都是采用的http1.1，也就是长连接。

如何判断是不是采用了长连接或者http1.1

```
Connection:keep-alive
```

## http的缺陷
http协议有一个缺陷，就是只是单行道，永远只能客户端向服务器要数据，不能让服务器主动的向客户端发数据，比如我们的微信，有新的好友发过来消息了，我们是不能知道的，如果我们想知道，我们只能采用轮询的方式：
轮询的原理很简单：每几秒让客户端向服务器请求一次最新的数据。

```
客户端：啦啦啦，有没有新信息(Request)
服务端：没有（Response）
客户端：啦啦啦，有没有新信息(Request)
服务端：没有。。（Response）
客户端：啦啦啦，有没有新信息(Request)
服务端：你好烦啊，没有啊。。（Response）
客户端：啦啦啦，有没有新消息（Request）
服务端：好啦好啦，有啦给你。（Response）
客户端：啦啦啦，有没有新消息（Request）
```

## websocket
websocket解决了这个问题，可以实现服务器主动向客户端推送数据

## websocket的应用
在线聊天室、在线客服系统

